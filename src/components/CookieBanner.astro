---
const CONSENT_KEY = "cookie_consent_v1";
---
<div id="cookie-banner" class="cookie" hidden>
  <div class="cookie__inner">
    <div class="cookie__text">
      <strong>Cookies</strong>
      <p>
        We use analytics cookies to understand traffic and improve the website.
        You can accept or reject analytics tracking.
      </p>
      <a class="cookie__link" href="/privacy">Learn more</a>
    </div>

    <div class="cookie__actions">
      <button class="btn btn--secondary" id="cookie-reject" type="button">Reject</button>
      <button class="btn btn--primary" id="cookie-accept" type="button">Accept</button>
    </div>
  </div>
</div>

<style>
  /* Cookie banner is intentionally styled locally to avoid global CSS collisions. */
  .cookie{
    position: fixed;
    left: 16px;
    right: 16px;
    bottom: calc(16px + env(safe-area-inset-bottom, 0px));
    z-index: 9999;
    display: block;
  }

  .cookie[hidden]{ display: none !important; }

  .cookie__inner{
    margin: 0 auto;
    max-width: 960px;
    width: 100%;
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    gap: 18px;

    padding: 16px 16px;
    border-radius: var(--radius);
    border: 1px solid var(--line);
    background: var(--paper);
    box-shadow: var(--shadow);
  }

  .cookie__text{
    min-width: 0;
  }

  .cookie__text strong{
    display: inline-block;
    font-size: 14px;
    letter-spacing: 0.02em;
    color: var(--ink);
    margin-bottom: 6px;
  }

  .cookie__text p{
    margin: 0;
    font-size: 14px;
    line-height: 1.45;
    color: rgba(17,17,17,0.74);
  }

  .cookie__link{
    display: inline-block;
    margin-top: 8px;
    font-size: 13px;
    color: var(--accent);
    text-decoration: none;
    border-bottom: 1px solid rgba(107,63,34,0.25);
  }
  .cookie__link:hover{ border-bottom-color: rgba(107,63,34,0.45); }

  .cookie__actions{
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: flex-end;
    flex-shrink: 0;
  }

  @media (max-width: 640px){
    .cookie{
      left: 12px;
      right: 12px;
      bottom: calc(12px + env(safe-area-inset-bottom, 0px));
    }
    .cookie__inner{
      flex-direction: column;
      align-items: stretch;
      padding: 14px 14px;
    }
    .cookie__actions{
      justify-content: stretch;
    }
    .cookie__actions .btn{
      width: 100%;
    }
  }
</style>

<script>
  const CONSENT_KEY = "cookie_consent_v1";
  const banner = document.getElementById("cookie-banner");
  const accept = document.getElementById("cookie-accept");
  const reject = document.getElementById("cookie-reject");

  function getStored(){
    try { return localStorage.getItem(CONSENT_KEY); } catch { return null; }
  }

  function showIfNeeded(){
    const v = getStored();
    if (v === "accepted" || v === "rejected") return;
    banner.hidden = false;
  }

  accept?.addEventListener("click", () => {
    banner.hidden = true;
    window.__setCookieConsent?.("accepted");
  });

  reject?.addEventListener("click", () => {
    banner.hidden = true;
    window.__setCookieConsent?.("rejected");
  });

  showIfNeeded();
</script>
